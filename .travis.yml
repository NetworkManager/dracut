language: generic
sudo: required
services:
- docker
env:
  matrix:
  - IMAGE=latest TESTS=70
  - IMAGE=latest TESTS=13
  - IMAGE=latest TESTS=14
  - IMAGE=latest TESTS=17

before_script:
  - docker pull fedora:$IMAGE
  - |
    sudo modprobe kvm-intel nested=1 || :
    sudo modprobe kvm-amd nested=1 || :
    dmesg | tail || :
  - git pull --depth=100
  - |
    git describe --abbrev=0 --tags || :
    git describe --tags || :

after_script:
  - find . /var/tmp/dracut-test* -name '*.log' |xargs tail -n666

script:
- docker run --privileged -it -v $(pwd)/:/dracut fedora:$IMAGE /dracut/fedora-test.sh $IMAGE-$$ "$TESTS"
